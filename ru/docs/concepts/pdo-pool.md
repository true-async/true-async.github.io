---
layout: docs
lang: ru
path_key: "/docs/concepts/pdo-pool.html"
nav_active: docs
permalink: /ru/docs/concepts/pdo-pool.html
page_title: "PDO Pool"
description: "PDO Pool ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ—Ä—É—Ç–∏–Ω: –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –ø—É–ª–∏–Ω–≥, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback."
---

# PDO Pool: –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ—Ä—É—Ç–∏–Ω–∞–º–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞ —à–∞—Ä–∏–Ω–≥–∞ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –≤–≤–æ–¥–∞ –≤—ã–≤–æ–¥–∞.
–ï—Å–ª–∏ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–æ–∫–µ—Ç –±—É–¥–µ—Ç –≤ –¥–≤—É—Ö –∫–æ—Ä—É—Ç–∏–Ω–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å—Ç–∞–Ω—É—Ç –ø–∏—Å–∞—Ç—å –∏–ª–∏ —á–∏—Ç–∞—Ç—å –∏–∑ –Ω–µ–≥–æ
—Ä–∞–∑–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, —Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ—à–∞—é—Ç—Å—è, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º.
–ü–æ—ç—Ç–æ–º—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç `PDO` –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ—Ä—É—Ç–∏–Ω–∞—Ö!

–° –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ—Ä—É—Ç–∏–Ω—ã —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞ –æ—á–µ–Ω—å —Ä–∞—Å—Ç–æ—á–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è.
–û–Ω–∞ —Å–≤–æ–¥–∏—Ç –Ω–∞ –Ω–µ—Ç –ø—Ä–µ–π–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –≤—ã–≤–æ–¥–∞. –ü–æ—ç—Ç–æ–º—É –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API,
–ë–∞–∑–∞–º–∏ –î–∞–Ω–Ω—ã—Ö –∏ –¥—Ä—É–≥–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.



```php
$pdo = new PDO('mysql:host=localhost;dbname=app', 'root', 'secret');

// –î–µ—Å—è—Ç—å –∫–æ—Ä—É—Ç–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω $pdo
for ($i = 0; $i < 10; $i++) {
    spawn(function() use ($pdo, $i) {
        $pdo->beginTransaction();
        $pdo->exec("INSERT INTO orders (user_id) VALUES ($i)");
        // –î—Ä—É–≥–∞—è –∫–æ—Ä—É—Ç–∏–Ω–∞ —É–∂–µ –≤—ã–∑–≤–∞–ª–∞ COMMIT –Ω–∞ —ç—Ç–æ–º –∂–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏!
        $pdo->commit(); // –•–∞–æ—Å
    });
}
```

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ –∫–∞–∂–¥–æ–π –∫–æ—Ä—É—Ç–∏–Ω–µ, –Ω–æ —Ç–æ–≥–¥–∞ –ø—Ä–∏ —Ç—ã—Å—è—á–µ –∫–æ—Ä—É—Ç–∏–Ω –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Ç—ã—Å—è—á—É TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
MySQL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑—Ä–µ—à–∞–µ—Ç 151 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. PostgreSQL ‚Äî 100.

## –†–µ—à–µ–Ω–∏–µ: PDO Pool

**PDO Pool** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ —è–¥—Ä–æ PHP –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
–û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞—ë—Ç –∫–∞–∂–¥–æ–π –∫–æ—Ä—É—Ç–∏–Ω–µ —Å–≤–æ—ë —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑ –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞
–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ, –∫–æ–≥–¥–∞ –∫–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞ —Ä–∞–±–æ—Ç—É.

```php
$pdo = new PDO('mysql:host=localhost;dbname=app', 'root', 'secret', [
    PDO::ATTR_POOL_ENABLED => true,
    PDO::ATTR_POOL_MIN => 2,
    PDO::ATTR_POOL_MAX => 10,
]);

// –î–µ—Å—è—Ç—å –∫–æ—Ä—É—Ç–∏–Ω ‚Äî –∫–∞–∂–¥–∞—è –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ—ë —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
for ($i = 0; $i < 10; $i++) {
    spawn(function() use ($pdo, $i) {
        // Pool –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–π –∫–æ—Ä—É—Ç–∏–Ω—ã
        $pdo->beginTransaction();
        $pdo->exec("INSERT INTO orders (user_id) VALUES ($i)");
        $pdo->commit();
        // –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—É–ª
    });
}
```

–°–Ω–∞—Ä—É–∂–∏ –∫–æ–¥ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫, –±—É–¥—Ç–æ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –æ–±—ã—á–Ω—ã–º `PDO`. –ü—É–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–µ–Ω.

## –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å

–ü—É–ª –≤–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ `PDO`:

```php
$pdo = new PDO($dsn, $user, $password, [
    PDO::ATTR_POOL_ENABLED              => true,  // –í–∫–ª—é—á–∏—Ç—å –ø—É–ª
    PDO::ATTR_POOL_MIN                  => 0,     // –ú–∏–Ω–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)
    PDO::ATTR_POOL_MAX                  => 10,    // –ú–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
    PDO::ATTR_POOL_HEALTHCHECK_INTERVAL => 30,    // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è (—Å–µ–∫, 0 = –≤—ã–∫–ª—é—á–µ–Ω–æ)
]);
```

| –ê—Ç—Ä–∏–±—É—Ç                     | –ó–Ω–∞—á–µ–Ω–∏–µ                                                              | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-----------------------------|-----------------------------------------------------------------------|--------------|
| `POOL_ENABLED`              | –í–∫–ª—é—á–∏—Ç—å –ø—É–ª                                                          | `false`      |
| `POOL_MIN`                  | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—É–ª –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ | `0`          |
| `POOL_MAX`                  | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π                      | `10`         |
| `POOL_HEALTHCHECK_INTERVAL` | –ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∂–∏–≤–æ–µ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)                | `0`          |

## –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∫–æ—Ä—É—Ç–∏–Ω–µ

–ö–∞–∂–¥–∞—è –∫–æ—Ä—É—Ç–∏–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç **—Å–≤–æ—ë** —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑ –ø—É–ª–∞. –í—Å–µ –≤—ã–∑–æ–≤—ã `query()`, `exec()`, `prepare()`
–≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –∫–æ—Ä—É—Ç–∏–Ω—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

```php
$pdo = new PDO($dsn, $user, $password, [
    PDO::ATTR_POOL_ENABLED => true,
    PDO::ATTR_POOL_MAX => 5,
]);

$coro1 = spawn(function() use ($pdo) {
    // –í—Å–µ —Ç—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞ –∏–¥—É—Ç —á–µ—Ä–µ–∑ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ #1
    $pdo->query("SELECT 1");
    $pdo->query("SELECT 2");
    $pdo->query("SELECT 3");
    // –ö–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å ‚Äî —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ #1 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—É–ª
});

$coro2 = spawn(function() use ($pdo) {
    // –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ #2
    $pdo->query("SELECT 4");
    // –ö–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å ‚Äî —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ #2 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—É–ª
});
```

–ï—Å–ª–∏ –∫–æ—Ä—É—Ç–∏–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ —Å—Ç–µ–π—Ç–º–µ–Ω—Ç–æ–≤),
–ø—É–ª –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ —Ä–∞–Ω—å—à–µ ‚Äî –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ—Ä—É—Ç–∏–Ω—ã.

## –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ –≤ –æ–±—ã—á–Ω–æ–º PDO. –ù–æ –ø—É–ª –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç,
—á—Ç–æ –ø–æ–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ **–∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ** –∑–∞ –∫–æ—Ä—É—Ç–∏–Ω–æ–π –∏ –Ω–µ –≤–µ—Ä–Ω—ë—Ç—Å—è –≤ –ø—É–ª.

```php
spawn(function() use ($pdo) {
    $pdo->beginTransaction();

    $pdo->exec("UPDATE accounts SET balance = balance - 100 WHERE id = 1");
    $pdo->exec("UPDATE accounts SET balance = balance + 100 WHERE id = 2");

    $pdo->commit();
    // –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ commit —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—É–ª
});
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback

–ï—Å–ª–∏ –∫–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å, –Ω–µ –≤—ã–∑–≤–∞–≤ `commit()`, –ø—É–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–∞—Ç–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
–ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ –ø—É–ª. –≠—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–π –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö.

```php
spawn(function() use ($pdo) {
    $pdo->beginTransaction();
    $pdo->exec("DELETE FROM users WHERE id = 1");
    // –ó–∞–±—ã–ª–∏ commit()
    // –ö–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å ‚Äî –ø—É–ª –≤—ã–∑–æ–≤–µ—Ç ROLLBACK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
});
```

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

![–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ –ø—É–ª–µ](/diagrams/ru/concepts-pdo-pool/connection-lifecycle.svg)

–ü–æ–¥—Ä–æ–±–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –≤—ã–∑–æ–≤–∞–º–∏ ‚Äî –≤ [–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ PDO Pool](/ru/architecture/pdo-pool.html).

## –î–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É –ø—É–ª–∞

–ú–µ—Ç–æ–¥ `getPool()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `Async\Pool`, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

```php
$pool = $pdo->getPool();

if ($pool !== null) {
    echo "–ü—É–ª –∞–∫—Ç–∏–≤–µ–Ω: " . get_class($pool) . "\n"; // Async\Pool
}
```

–ï—Å–ª–∏ –ø—É–ª –Ω–µ –≤–∫–ª—é—á—ë–Ω, `getPool()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null`.

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PDO Pool, –∫–æ–≥–¥–∞:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ —Å TrueAsync
- –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ—Ä—É—Ç–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ù—É–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –ë–î

**–ù–µ –Ω—É–∂–µ–Ω, –∫–æ–≥–¥–∞:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π PHP)
- –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–æ—Ä—É—Ç–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–∞–∑–æ–π
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è persistent-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–æ–Ω–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å –ø—É–ª–æ–º)

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã

| –î—Ä–∞–π–≤–µ—Ä      | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—É–ª–∞ |
|--------------|----------------|
| `pdo_mysql`  | –î–∞             |
| `pdo_pgsql`  | –î–∞             |
| `pdo_sqlite` | –î–∞             |
| `pdo_odbc`   | –ù–µ—Ç            |

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ï—Å–ª–∏ –ø—É–ª –Ω–µ —Å–º–æ–≥ —Å–æ–∑–¥–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–Ω–µ–≤–µ—Ä–Ω—ã–µ credentials, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π —Å–µ—Ä–≤–µ—Ä),
–∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ—Ä—É—Ç–∏–Ω—É, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—Ä–æ—Å–∏–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:

```php
$pdo = new PDO('mysql:host=localhost;dbname=app', 'root', 'wrong_password', [
    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
    PDO::ATTR_POOL_ENABLED => true,
    PDO::ATTR_POOL_MIN => 0,
]);

spawn(function() use ($pdo) {
    try {
        $pdo->query("SELECT 1");
    } catch (PDOException $e) {
        echo "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è: " . $e->getMessage() . "\n";
    }
});
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ `POOL_MIN => 0`: –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∏–Ω–∏–º—É–º –±–æ–ª—å—à–µ –Ω—É–ª—è, –ø—É–ª –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è
—Å–æ–∑–¥–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞—Ä–∞–Ω–µ–µ, –∏ –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç —É–∂–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞ PDO.

## –†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤

```php
use function Async\spawn;
use function Async\await;

$pdo = new PDO('mysql:host=localhost;dbname=shop', 'app', 'secret', [
    PDO::ATTR_ERRMODE            => PDO::ERRMODE_EXCEPTION,
    PDO::ATTR_POOL_ENABLED       => true,
    PDO::ATTR_POOL_MIN           => 2,
    PDO::ATTR_POOL_MAX           => 5,
]);

// –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
$orders = [101, 102, 103, 104, 105, 106, 107, 108, 109, 110];

$coroutines = [];
foreach ($orders as $orderId) {
    $coroutines[] = spawn(function() use ($pdo, $orderId) {
        // –ö–∞–∂–¥–∞—è –∫–æ—Ä—É—Ç–∏–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ—ë —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑ –ø—É–ª–∞
        $pdo->beginTransaction();

        $stmt = $pdo->prepare("SELECT * FROM orders WHERE id = ? FOR UPDATE");
        $stmt->execute([$orderId]);
        $order = $stmt->fetch();

        if ($order['status'] === 'pending') {
            $pdo->exec("UPDATE orders SET status = 'processing' WHERE id = $orderId");
            $pdo->exec("INSERT INTO order_log (order_id, action) VALUES ($orderId, 'started')");
        }

        $pdo->commit();
        return $orderId;
    });
}

// –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∫–æ—Ä—É—Ç–∏–Ω
foreach ($coroutines as $coro) {
    $processedId = await($coro);
    echo "–ó–∞–∫–∞–∑ #$processedId –æ–±—Ä–∞–±–æ—Ç–∞–Ω\n";
}
```

–î–µ—Å—è—Ç—å –∑–∞–∫–∞–∑–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ, –Ω–æ —á–µ—Ä–µ–∑ –º–∞–∫—Å–∏–º—É–º –ø—è—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –±–∞–∑–µ.
–ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞. –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–µ–∂–¥—É –∫–æ—Ä—É—Ç–∏–Ω–∞–º–∏.

## –î–∞–ª—å—à–µ —á—Ç–æ?

- [**üé¨ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è PDO Pool**](/ru/interactive/pdo-pool-demo.html) ‚Äî –Ω–∞–≥–ª—è–¥–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ PDO Pool](/ru/architecture/pdo-pool.html) ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø—É–ª–∞, –¥–∏–∞–≥—Ä–∞–º–º—ã, –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- [–ö–æ—Ä—É—Ç–∏–Ω—ã](/ru/docs/concepts/coroutines.html) ‚Äî –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—É—Ç–∏–Ω—ã
- [Scope](/ru/docs/concepts/scope.html) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏ –∫–æ—Ä—É—Ç–∏–Ω
- [spawn()](/ru/docs/reference/spawn.html) ‚Äî –∑–∞–ø—É—Å–∫ –∫–æ—Ä—É—Ç–∏–Ω
- [await()](/ru/docs/reference/await.html) ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
